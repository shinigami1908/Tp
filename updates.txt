# Updated Bias Lexicon — keyword : category
BIAS_LEXICON = {
    "recently": "recency",
    "lately": "recency",
    "last sprint": "recency",
    "this month": "recency",
    "gets along": "affinity",
    "likeable": "affinity",
    "culture fit": "affinity",
    "quiet": "style",
    "aggressive": "style",
    "not outspoken": "style",
    "communication style": "style",
    "seems": "opinion_only",
    "appears": "opinion_only",
    "feels like": "opinion_only",
}

# New expected rating thresholds
def _level_to_rating(score: float) -> str:
    if score >= 0.85:
        return "Consistently Exceeds"
    if score >= 0.65:
        return "Exceeds"
    if score >= 0.45:   # tightened
        return "Meets"
    if score >= 0.30:
        return "Inconsistently Meets"
    return "Needs Improvement"



def _bias_lexicon_tags(text: str) -> List[str]:
    if not isinstance(text, str):
        return []
    t = text.lower()
    hits: List[str] = []
    for kw, category in BIAS_LEXICON.items():
        if kw in t:
            hits.append(kw)  # return the actual biased term, not category
    return sorted(set(hits))





# Delivery — reduced contribution
if spill <= 10:
    score += 0.15
elif spill <= 25:
    score += 0.07

if velocity >= 50:
    score += 0.15
elif velocity >= 20:
    score += 0.07

# 360 Sentiment — reduced contribution
if pos >= 70:
    score += 0.07
elif pos >= 50:
    score += 0.03
